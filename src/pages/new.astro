---
import gradesData from "../data/grades.json";
import missingAssignmentsData from "../data/missing_assignments.json";
import BaseLayout from "../layouts/BaseLayout.astro";

const data = gradesData.classes.map((classInfo) => ({
    class: classInfo.class_name,
    teacher: classInfo.teacher,
    q1_grade: classInfo.q1_grade,
    q1_letter_grade: classInfo.q1_letter_grade,
    q2_grade: classInfo.q2_grade,
    q2_letter_grade: classInfo.q2_letter_grade,
    period: classInfo.period,
    grade: classInfo.current_grade,
    lettergrade: classInfo.letter_grade,
}));

const metadata = {
    last_updated: gradesData.metadata.last_updated
};

const missingAssignments = missingAssignmentsData.missing_assignments?.map(
    (assignment) => ({
        assignment: assignment.assignment_name,
        class: assignment.class_name,
        due: assignment.due_date,
        points: assignment.max_points,
    }),
) ?? [];

function getGradeColor(grade: number): string {
    if (grade >= 90) return "grade-a";
    if (grade >= 80) return "grade-b";
    if (grade >= 70) return "grade-c";
    if (grade >= 60) return "grade-d";
    return "grade-f";
}
---

<BaseLayout>
    <section class="py-16">
        <div class="container px-4 mx-auto">
            <div class="mb-8">
                <h1 class="text-3xl font-bold font-heading text-white mb-2">
                    Missing Assignments
                </h1>
                <p class="text-gray-300">
                    Updated {metadata.last_updated}. Total missing: {missingAssignments.length}
                </p>
            </div>

            {missingAssignments.length === 0 ? (
                <div class="bg-[#000] border-2 border-white p-6 text-center text-white">
                    No missing assignments found.
                </div>
            ) : (
                <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
                    {missingAssignments.map((item) => (
                        <div class="bg-[#000] border-2 border-[#00ffff] p-5">
                            <div class="text-sm uppercase text-[#00ffff] mb-2">
                                {item.class}
                            </div>
                            <div class="text-lg font-bold text-white mb-2">
                                {item.assignment}
                            </div>
                            <div class="text-sm text-gray-300 mb-3">
                                Due: {item.due}
                            </div>
                            <div class="inline-flex items-center gap-2 text-sm uppercase text-white border border-white px-3 py-1">
                                {item.points} pts
                            </div>
                        </div>
                    ))}
                </div>
            )}
        </div>
    </section>
</BaseLayout>
